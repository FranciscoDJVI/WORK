{% extends "base.html" %}
<!doctype html>
<title>{% block title %}sell-product{% endblock %}</title>
{% block content %}
<nav class="mx-10 my-10 text-blue-950 p-3 absolute top-0 right-30 text-xl">
  <a href="{% url 'list-product' %}">all productos/</a>
  <a href="{% url 'register_product' %}">register/</a>
  <a href="{% url 'delete-product' %}">delete/</a>
  <a href="{% url 'update-product' %}">update/</a>
  <a href="{% url 'stock_products' %}">stock/</a>
  <a href="{% url 'main' %}">home<a />
</nav>
<section class="mx-20 my-40 grid justify-items-center items-center">
  <form class="bg-white my-5  grid grid-cols-3 grid-rows-1 justify-items-center items-center p-5" method="post">
    {% csrf_token %}
    {{ formsell }}
    <button id="sell" name="sell" type="submit"
      class="bg-green-700 text-3xl text-gray-200 w-20 rounded-3xl  p-2">+</button>
  </form>
  <aside class="h-[fit-contect] w-[fit-content] bg-white p-2 mb-10 rounded-3xl">
    {% include "listsellproducts.html" %}
  </aside>
  <section class="bg-white grid  grid-cols-1 grid-rows-1 gap-2 justify-items-center items-center">
    <form method="post"
      class="bg-white my-20  grid grid-cols-4 grid-rows-1 justify-items-center items-center rounded-2xl">
      {% csrf_token %}
      {{ formregsitersell }}
      <button id="add" name="add" type="submit"
        class="bg-green-700  text-xl text-gray-200 rounded-2xl  p-2">add</button>
    </form>
    <form method="post">
      {% csrf_token %}
      {{ sentform }}
      <button id="sent" name="sent" type="submit"
        class="bg-green-700  text-xl text-gray-200 rounded-2xl mb-10  p-2">Sent sell</button>
    </form>
  </section>
  <div class="section">
    <h2>Búsqueda de Clientes por Correo</h2>
    <form action="" method="GET" class="search-form-inline">
      <div class="form-group">
        <label for="{{ formsearch.query.id_for_label }}">Buscar Correo:</label>
        {{ formsearch.query }}
        {% if formsearch.query.help_text %}<small>{{ formsearch.query.help_text }}</small>{% endif %}
        {% for error in formsearch.query.errors %}<span style="color: red;">{{ error }}</span>{% endfor %}
      </div>
      <button type="submit">Buscar Cliente</button>
    </form>

    <div class="search-results">
      {% if search_query %}
      <h3>Resultados para "{{ search_query }}"</h3>
      {% if search_results %}
      {% for client in search_results %}
      <div class="client-item">
        <p><strong>Correo:</strong> {{ client.email }}</p>
        {% if client.name %}<p><strong>Nombre:</strong> {{ client.name }}</p>{% endif %}
        {% if client.telephone %}<p><strong>Teléfono:</strong> {{ client.telephone }}</p>{% endif %}
      </div>
      {% endfor %}
      {% else %}
      <p class="no-results">No se encontraron clientes con el correo "{{ search_query }}".</p>
      {% endif %}
      {% else %}
      <p class="no-results">Usa la barra de búsqueda para encontrar clientes por correo electrónico.</p>
      {% endif %}
    </div>
    <div class="form-group" style="margin-top: 20px;">
      <label for="id_client_email_selected">Correo del Cliente Seleccionado (para envío de correo):</label>
      <input type="email" id="id_client_email_selected" name="client_email_selected" placeholder="ejemplo@dominio.com"
        readonly style="background-color: #f0f0f0;">
      <small>Este campo se llenará automáticamente al hacer clic en un correo de la búsqueda.</small>
    </div>
  </div>
</section>
{% if messages %}
<div id="messages" class="bg-blue-950 text-2xl text-gray-200 absolute bottom-10 right-10 rounded-4xl italic p-10">
  <ul class="messages">
    {% for message in messages %}
    <span class="{{ message.tag}}">{{message}}</span>
    {% endfor %}
  </ul>
</div>
{% endif %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const temporalMessage = document.getElementById('messages');
    if (temporalMessage) {
      // Show the message "Producto guarado con exito", for 10 seconds.
      setTimeout(function () {
        temporalMessage.style.display = 'none'
      }, 10000);
    }
  });

    // JavaScript para copiar el correo seleccionado al campo oculto/input readonly
    document.addEventListener('DOMContentLoaded', function() {
        const emailSpans = document.querySelectorAll('.client-email-copy');
        const selectedEmailInput = document.getElementById('id_client_email_selected');
        const hiddenEmailInput = document.getElementById('hidden_client_email_selected');

        emailSpans.forEach(span => {
            span.addEventListener('click', function() {
                const email = this.dataset.email;
                selectedEmailInput.value = email;
                hiddenEmailInput.value = email; // También actualiza el campo oculto
                alert('Correo copiado: ' + email);
            });
        });
    });
</script>
{% include "footer.html" %}
{% endblock %}